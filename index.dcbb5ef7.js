class t{constructor(e=t.defaultState()){this.score=0,this.status="idle",this.initialState=this.cloneState(e),this.state=this.cloneState(e),this.size=e.length}static defaultState(){return Array.from({length:4},()=>[,,,,].fill(0))}getScore(){return this.score}getState(){return this.state}getStatus(){return this.status}start(){"idle"===this.status&&(this.status="playing",this.addRandomTile(),this.addRandomTile())}restart(){this.state=this.cloneState(this.initialState),this.score=0,this.status="idle"}addRandomTile(){let t=this.getEmptyTiles();if(t.length>0){let e=Math.floor(Math.random()*t.length),[s,i]=t[e];this.state[s][i]=.9>Math.random()?2:4}}move(t){"playing"===this.status&&this.performMove(t)&&(this.addRandomTile(),this.checkGameState())}moveRight(){this.move("right")}moveLeft(){this.move("left")}moveUp(){this.move("up")}moveDown(){this.move("down")}hasEmptyCells(){return this.getEmptyTiles().length>0}canCombine(){for(let t=0;t<this.size;t++)for(let e=0;e<this.size;e++){let s=this.state[t][e];if(e<this.size-1&&s===this.state[t][e+1]||t<this.size-1&&s===this.state[t+1][e])return!0}return!1}checkGameState(){for(let t of this.state)if(t.includes(2048)){this.status="win";return}this.hasEmptyCells()||this.canCombine()||(this.status="lose")}performMove(t){let e=this.cloneState(this.state),s=[],i="up"===t||"down"===t,r="right"===t||"down"===t;for(let t of i?this.transposeState(this.state):this.state){let e=r?[...t].reverse():t,i=this.combineRow(e),a=this.padRow(i),o=r?a.reverse():a;s.push(o)}return this.state=i?this.transposeState(s):s,!this.areStatesEqual(e,this.state)}combineRow(t){let e=[],s=t.filter(t=>0!==t);for(let t=0;t<s.length;t++)if(s[t]===s[t+1]){let i=2*s[t];e.push(i),this.score+=i,t++}else e.push(s[t]);return e}padRow(t){return[...t,...Array(this.size-t.length).fill(0)]}cloneState(t){return t.map(t=>[...t])}areStatesEqual(t,e){for(let s=0;s<t.length;s++)for(let i=0;i<t[s].length;i++)if(t[s][i]!==e[s][i])return!1;return!0}transposeState(t){return t[0].map((e,s)=>t.map(t=>t[s]))}getEmptyTiles(){let t=[];for(let e=0;e<this.size;e++)for(let s=0;s<this.size;s++)0===this.state[e][s]&&t.push([e,s]);return t}}const e=new t,s=Array.from(document.querySelectorAll(".field-cell")),i=document.querySelector(".button.start"),r=document.querySelector(".game-score"),a=document.querySelector(".message-win"),o=document.querySelector(".message-lose"),l=document.querySelector(".message-start"),n={ArrowLeft:()=>e.moveLeft(),ArrowRight:()=>e.moveRight(),ArrowUp:()=>e.moveUp(),ArrowDown:()=>e.moveDown()},h=()=>{let t=e.getState().flat();s.forEach((e,s)=>{let i=t[s];e.className="field-cell",e.textContent=i||"",i&&e.classList.add(`field-cell--${i}`)})},u=()=>{r.textContent=e.getScore()},c=()=>{let t=e.getStatus();"win"===t&&a.classList.remove("hidden"),"lose"===t&&o.classList.remove("hidden")},m=()=>{h(),u(),c()},d=()=>{[a,o,l].forEach(t=>{t.classList.add("hidden")})};document.addEventListener("keydown",t=>{if("playing"!==e.getStatus())return;let s=n[t.key];s&&(s(),m())}),i.addEventListener("click",()=>{i.classList.contains("restart")&&e.restart(),e.start(),d(),m(),i.textContent="Restart",i.className="button restart"});
//# sourceMappingURL=index.dcbb5ef7.js.map
